# Story 2.1: Notebook and Page Management System

## Status

Ready for Review

## Story

As a user,
I want to create and organize notebooks with flat notes in a three-column interface,
so that I can structure my notes in a logical, organized manner with intuitive navigation.

## Design Reference

**Figma Design:** [Notebook and Page Management UI](https://www.figma.com/design/J4Dsi0o3FCgCgqrvPCAehY/Untitled?node-id=0-1&p=f&t=IQnLuDhX4ei3mhjS-0)

**Key Design Elements:**

- Three-column layout: Notebooks (left), Notes (middle), Note Detail (right)
- Clean, minimalist design with white background and grey text
- Yellow accent color for selected items and action buttons
- Navigation icons on far left: document/page, people, disk/save
- Search functionality with "Q Search notes" placeholder
- Grid/list view toggle for notes display
- Rich text editor toolbar at bottom of detail view
- Pin/unpin functionality for notebooks and notes

## Acceptance Criteria

1. Create notebook creation and deletion functionality
2. Add drag-and-drop note reordering within notebooks
3. Create note creation, editing, and deletion functionality
4. Add notebook and note renaming capabilities
5. Implement quick note navigation with search
6. Add notebook and note metadata (creation date, last modified)
7. Store notebook and note structure in Firestore
8. **NEW:** Implement three-column layout matching Figma design
9. **NEW:** Add navigation sidebar with document, people, and save icons
10. **NEW:** Implement pin/unpin functionality for notebooks and notes
11. **NEW:** Add grid/list view toggle for notes display
12. **NEW:** Create search bar with "Q Search notes" placeholder
13. **NEW:** Implement yellow accent color for selected items and action buttons
14. **NEW:** Add rich text editor toolbar at bottom of detail view
15. **NEW:** Implement "New Notebook" modal dialog matching Figma design
16. **NEW:** Add notebook creation form with name and description fields
17. **NEW:** Implement form validation and submission handling
18. **NEW:** Add success feedback and navigation after notebook creation

## Tasks / Subtasks

- [x] Three-column layout implementation (AC: 8)
  - [x] Create main layout component with three responsive columns
  - [x] Implement column resizing and responsive breakpoints
  - [x] Add proper spacing and visual separation between columns
  - [x] Ensure accessibility with proper ARIA landmarks
- [x] Navigation sidebar (AC: 9)
  - [x] Create left navigation with document, people, and save icons
  - [x] Implement icon selection states and hover effects
  - [x] Add keyboard navigation support
  - [x] Wire navigation to appropriate app sections
- [x] Notebooks column (AC: 1, 4, 6, 10, 13)
  - [x] Data model for `Notebook` (id, name, description, metadata, pinned)
  - [x] Create, rename, delete notebook operations
  - [x] Implement pin/unpin functionality with visual indicators
  - [x] Display notebook list with descriptions and last updated times
  - [x] Persist notebook metadata (createdAt, updatedAt, pinned) in Firestore
- [x] Notes column (AC: 2, 3, 4, 5, 8, 9, 10, 11, 12)
  - [x] Data model for `Note` (flat structure within notebooks)
  - [x] Create, rename, delete note operations with pin/unpin support
  - [x] Implement search bar with "Q Search notes" placeholder
  - [x] Add grid/list view toggle with proper icon states
  - [x] Display notes with titles, descriptions, and last updated times
  - [x] Implement search functionality across current notebook notes
  - [x] Fuzzy match and highlight search results
- [x] Drag-and-drop reordering (AC: 2)
  - [x] Implement DnD in notes list with keyboard-accessible reorder
  - [x] Update ordering/index fields in Firestore
  - [x] Handle flat list reordering within notebooks
- [x] Note detail view (AC: 3, 4, 6, 14)
  - [x] Create detailed note view in right column
  - [x] Display note title, last updated time, and full content
  - [x] Implement rich text editor toolbar at bottom
  - [x] Add toolbar with formatting options (bold, italic, underline, alignment, lists, etc.)
  - [x] Wire toolbar actions to rich text editor functionality
- [x] Visual design implementation (AC: 13)
  - [x] Implement clean, minimalist design with white background
  - [x] Add yellow accent color for selected items and action buttons
  - [x] Create proper hover and focus states
  - [x] Performance optimization for large note lists (virtualization where needed)
- [x] Firestore integration (AC: 7)
  - [x] Define converters/types and validation
  - [x] Real-time listeners for notebooks and notes
  - [x] Error handling, retry, and empty/loading states
- [x] **NEW:** "New Notebook" modal implementation (AC: 15, 16, 17, 18)
  - [x] Create modal with title "New Notebook" and close button
  - [x] Add "Name" input field with placeholder "e.g., Marketing Campaign Q3"
  - [x] Add "Description (optional)" textarea with placeholder "e.g., A place for all assets and notes for the upcoming campaign."
  - [x] Implement "Cancel" and "Create Notebook" buttons (yellow primary button)
  - [x] Add form validation for required name field
  - [x] Implement form submission with Firestore integration
  - [x] Add success feedback and modal close on successful creation
  - [x] Handle error states and user-friendly error messages

## Dev Notes

- Align data models and Firestore structure with Epic 2 and Firestore best practices.
- Consider batched writes and transactions for reorder operations.
- Ensure accessibility: keyboard DnD alternatives, ARIA list patterns.
- **Design Implementation Notes:**
  - Follow the three-column layout from Figma design: Notebooks (left), Notes (middle), Note Detail (right)
  - Use Material UI components with custom theming to match the clean, minimalist design
  - Implement yellow accent color (#FFD700 or similar) for selected items and action buttons
  - Navigation sidebar should be fixed width with proper icon spacing
  - Search functionality should be prominently placed in the Notes column header
  - Grid/list toggle should be positioned next to the search bar
  - Rich text editor toolbar should be fixed at the bottom of the detail view
  - Pin/unpin functionality should use appropriate icons and visual feedback

### Testing

- Unit tests: data model helpers and Firestore API wrappers.
- Component tests: notes list renders correctly, rename inline edit.
- Interaction tests: drag-and-drop reorders and persists changes.
- Integration tests: create notebook/note and see real-time updates.
- **UI/UX Testing:**
  - Test three-column layout responsiveness across different screen sizes
  - Verify navigation sidebar functionality and icon states
  - Test search functionality with various input scenarios
  - Validate grid/list view toggle behavior
  - Test pin/unpin functionality with visual feedback
  - Verify yellow accent color application for selected items
  - Test rich text editor toolbar functionality

## Dev Agent Record

### Agent Model Used

Claude Sonnet 4 (via Cursor)

### Debug Log References

- Navigation sidebar implementation with keyboard shortcuts
- Notebook data model and Firestore integration
- CRUD operations for notebooks with pin/unpin functionality
- Yellow accent color implementation matching Figma design

### Completion Notes List

- ✅ Navigation sidebar created with document, people, and save icons
- ✅ Icon selection states and hover effects implemented
- ✅ Keyboard navigation support added (Ctrl+1, Ctrl+2, Ctrl+S)
- ✅ Navigation wired to app sections
- ✅ Notebook data model created with proper TypeScript types
- ✅ Notebook CRUD operations implemented with Firestore integration
- ✅ Pin/unpin functionality with visual indicators
- ✅ Notebook list displays descriptions and last updated times
- ✅ Real-time Firestore listeners for live updates
- ✅ Context menu for notebook actions (pin/unpin, delete)
- ✅ Yellow accent color (#FFD700) applied to selected items and buttons
- ✅ "New Notebook" modal updated to match Figma design
- ✅ Notes data model implemented with flat structure within notebooks
- ✅ Notes CRUD operations with pin/unpin support
- ✅ Search functionality with "Q Search notes" placeholder
- ✅ Grid/list view toggle with proper icon states
- ✅ Notes display with titles, descriptions, and last updated times
- ✅ Search functionality across current notebook notes
- ✅ Fuzzy match and highlight search results
- ✅ Drag-and-drop reordering with HTML5 drag and drop API
- ✅ Note detail view in right column with auto-save
- ✅ Rich text editor toolbar at bottom
- ✅ Visual design implementation with clean, minimalist design
- ✅ Firestore integration with real-time listeners and error handling

### File List

- `src/components/layout/NavigationSidebar.tsx` - New navigation sidebar component
- `src/components/layout/AppShell.tsx` - Updated to include navigation sidebar
- `src/components/layout/NotebooksSidebar.tsx` - Updated with real data and CRUD operations
- `src/components/layout/NotesList.tsx` - Updated with real data, search, grid/list view, and drag-and-drop
- `src/components/layout/NoteEditor.tsx` - Updated with real data, auto-save, and rich text toolbar
- `src/components/ui/AddNotebookModal.tsx` - Updated to match Figma design
- `src/types/notebook.ts` - New TypeScript types for notebooks and notes
- `src/services/notebookService.ts` - New service for notebook and note operations

## Change Log

| Date       | Version | Description                                                                     | Author          |
| ---------- | ------- | ------------------------------------------------------------------------------- | --------------- |
| 2024-12-18 | 0.1     | Initial draft created from PRD Epic 2 Story 2.1                                 | Scrum Master    |
| 2024-12-24 | 0.2     | Updated with Figma design reference and three-column layout requirements        | Scrum Master    |
| 2025-01-27 | 0.3     | Added "New Notebook" modal dialog implementation with form validation           | Product Owner   |
| 2025-01-27 | 0.4     | Removed hierarchical page structure - simplified to flat notes within notebooks | Product Manager |
