# Story 2.1: Notebook and Page Management System

## Status
Draft

## Story
As a user,
I want to create and organize notebooks with hierarchical pages,
so that I can structure my notes in a logical, organized manner.

## Acceptance Criteria
1. Create notebook creation and deletion functionality
2. Implement hierarchical page structure within notebooks
3. Add drag-and-drop page reordering within notebooks
4. Create page creation, editing, and deletion functionality
5. Implement infinite nested sub-pages support
6. Add notebook and page renaming capabilities
7. Create visual hierarchy display with indentation and icons
8. Implement quick page navigation with search
9. Add notebook and page metadata (creation date, last modified)
10. Store notebook and page structure in Firestore

## Tasks / Subtasks
- [ ] Notebook CRUD (AC: 1, 6, 9, 10)
  - [ ] Data model for `Notebook` (id, name, metadata)
  - [ ] Create, rename, delete notebook operations
  - [ ] Persist notebook metadata (createdAt, updatedAt) in Firestore
- [ ] Page tree with infinite nesting (AC: 2, 5, 10)
  - [ ] Data model for `Page` with parentId for hierarchy
  - [ ] Firestore structure for nested pages (collection/field strategy)
  - [ ] Create read/write APIs for hierarchical retrieval
- [ ] Page CRUD (AC: 4, 6, 9, 10)
  - [ ] Create, rename, delete page operations
  - [ ] Edit page title and metadata; update timestamps
  - [ ] Wire Firestore writes with optimistic UI updates
- [ ] Drag-and-drop reordering (AC: 3)
  - [ ] Implement DnD in page tree with keyboard-accessible reorder
  - [ ] Update ordering/index fields and parent changes in Firestore
  - [ ] Handle cross-level moves and constraints
- [ ] Visual hierarchy UI (AC: 7)
  - [ ] Indented tree view with expand/collapse
  - [ ] Icons for notebooks/pages; active/hover/focus states
  - [ ] Performance for large trees (virtualization where needed)
- [ ] Quick navigation + search (AC: 8)
  - [ ] Search by title across current notebook pages
  - [ ] Keyboard shortcut to open quick navigator
  - [ ] Fuzzy match and highlight results
- [ ] Firestore integration (AC: 10)
  - [ ] Define converters/types and validation
  - [ ] Real-time listeners for notebooks and pages
  - [ ] Error handling, retry, and empty/loading states

## Dev Notes
- Align data models and Firestore structure with Epic 2 and Firestore best practices.
- Consider batched writes and transactions for reorder/move operations.
- Ensure accessibility: keyboard DnD alternatives, ARIA tree patterns.

### Testing
- Unit tests: data model helpers and Firestore API wrappers.
- Component tests: tree renders hierarchy, expand/collapse, rename inline edit.
- Interaction tests: drag-and-drop reorders and persists changes.
- Integration tests: create notebook/page and see real-time updates.

## Change Log
| Date | Version | Description | Author |
| ---- | ------- | ----------- | ------ |
| 2025-09-08 | 0.1 | Initial draft created from PRD Epic 2 Story 2.1 | Scrum Master |


