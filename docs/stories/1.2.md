# Story 1.2: Google SSO Authentication

## Status

Ready for Review

## Story

As a user,
I want to sign in with my Google account,
so that I can securely access the note-taking application.

## Acceptance Criteria

1. Implement Firebase Authentication with Google provider
2. Create login page with Google sign-in button matching Figma design
3. Handle authentication state changes and user session management
4. Implement logout functionality
5. Create protected routes that require authentication
6. Display user profile information (name, email, avatar)
7. Handle authentication errors and display user-friendly messages
8. Implement automatic token refresh
9. Store user authentication state in Redux/Zustand
10. Create loading states for authentication process

## Tasks / Subtasks

- [x] Implement Firebase Google Auth provider (AC: 1)
  - [x] Add GoogleAuthProvider and signInWithPopup
  - [x] Configure Drive App Data scope: `https://www.googleapis.com/auth/drive.appdata`
  - [x] Extract OAuth access token for Drive API calls
- [x] Create Login page matching Figma design (AC: 2)
  - [x] Implement clean, minimalist white background layout
  - [x] Add centered "Biblion" title in large, bold black text
  - [x] Add subtitle "Your AI-powered smart note-taking app" in smaller black text
  - [x] Create prominent yellow Google sign-in button with rounded corners
  - [x] Include Google 'G' icon on left side of button
  - [x] Add "Sign in with Google" text in black on button
  - [x] Ensure proper spacing and centering as per design
  - [x] Wire click handler to Firebase sign-in flow
- [x] Auth state and session management (AC: 3, 8, 9, 10)
  - [x] Subscribe to onAuthStateChanged and persist user
  - [x] Store auth state in chosen state store (Redux or Zustand)
  - [x] Implement token refresh handling (Firebase SDK auto-refreshes tokens)
  - [x] Add loading and error states around auth transitions
- [x] Logout functionality (AC: 4)
  - [x] Add signOut and UI trigger
- [x] Protected routes (AC: 5)
  - [x] Create PrivateRoute wrapper or route guard
  - [x] Redirect unauthenticated users to Login
- [x] User profile display (AC: 6)
  - [x] Show name, email, avatar after login
  - [x] Add fallback avatar if missing
- [x] Error handling UX (AC: 7)
  - [x] Map common auth errors to friendly messages
  - [x] Log technical details to console/dev log

## Dev Notes

### Architecture Context

[Source: architecture/biblion-architecture-frontend-only-google-drive-storage-pwa-ready.md]

**Tech Stack:**

- React 18.2.0 with TypeScript 5.4.5
- Vite 5.2.0 as bundler/dev server
- Material UI 5.15.20 for UI components with theming
- Firebase 10.12.2 for authentication
- React Router 6.26.2 for SPA routing

**Firebase Integration:**

- Use Firebase Authentication with Google provider
- Configure GoogleAuthProvider with Drive App Data scope: `https://www.googleapis.com/auth/drive.appdata`
- Use `signInWithPopup` for sign-in flow
- Extract OAuth access token: `GoogleAuthProvider.credentialFromResult(result)?.accessToken`
- Store access token for Drive API calls with `Authorization: Bearer <token>`

**Project Structure:**
[Source: architecture/biblion-architecture-frontend-only-google-drive-storage-pwa-ready.md]

- `/src/features/auth/` - Firebase Auth glue, provider, hooks
- `/src/components/ui/` - reusable MUI-based components
- `/src/app/` - App.tsx, main.tsx, routes.tsx, theme.ts
- `/src/lib/` - utilities and helpers

**Authentication Flow:**

1. Initialize Firebase app and Auth
2. Configure GoogleAuthProvider with Drive scopes
3. Use signInWithPopup for user authentication
4. Extract OAuth access token for Drive API usage
5. Store authentication state in memory/state management
6. Handle token refresh via Firebase session

**UI Design Requirements:**
Based on provided Figma design:

- Clean, minimalist white background
- Centered "Biblion" title in large, bold black text
- Subtitle "Your AI-powered smart note-taking app" in smaller black text
- Prominent yellow Google sign-in button with rounded corners
- Google 'G' icon on left side of button
- "Sign in with Google" text in black on button
- Proper spacing and centering throughout

### Testing

- Unit tests: auth service methods (login, logout, token refresh)
- Component tests: Login page button triggers sign-in; route guard redirects
- Integration smoke: auth state persists across reload; user profile renders
- Visual regression tests: Login page matches Figma design specifications

## Change Log

| Date       | Version | Description                                                       | Author       |
| ---------- | ------- | ----------------------------------------------------------------- | ------------ |
| 2025-01-27 | 0.1     | Initial draft created from PRD Epic 1 Story 1.2                   | Scrum Master |
| 2025-01-27 | 0.2     | Updated with Figma design specifications and architecture context | Scrum Master |
